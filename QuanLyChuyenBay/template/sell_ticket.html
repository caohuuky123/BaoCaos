{% extends 'layout/base.html' %}

{% block content %}
<div class="container my-5">
    <h2 class="text-center">Bán Vé Chuyến Bay</h2>
    {% if message %}
    <div class="alert alert-success">{{ message }}</div>
    {% endif %}
    <form method="POST" action="{{ url_for('sell_ticket_view') }}">
        <!-- Phần tra cứu chuyến bay và điền thông tin vé -->
        <div class="form-group">
            <label for="from">Điểm đi:</label>
            <select class="form-control" id="from" name="from">
                <option value="">Chọn địa điểm đi</option>
                {% for dia_diem in ten_dia_diem %}
                <option value="{{ dia_diem.ten_sb }}" {% if dia_diem.ten_sb == from_place %}selected{% endif %}>{{ dia_diem.ten_sb }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="to">Điểm đến:</label>
            <select class="form-control" id="to" name="to">
                <option value="">Chọn địa điểm đến</option>
                {% for dia_diem in ten_dia_diem %}
                <option value="{{ dia_diem.ten_sb }}" {% if dia_diem.ten_sb == to_place %}selected{% endif %}>{{ dia_diem.ten_sb }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="date">Ngày đi:</label>
            <input type="date" class="form-control" id="date" name="date" value="{{ date }}">
        </div>
        <button type="submit" class="btn btn-primary mt-2" name="tra_cuu_chuyen_bay">Tra cứu</button>

        <!-- Kết quả tra cứu và điền thông tin vé -->
        {% if chuyen_bays %}
        <h4 class="mt-4">Các Chuyến Bay</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                   <tr>
                        <th>ID</th>
                        <th>Ngày giờ bay</th>
                        <th>Vé hạng 1</th>
                        <th>Vé hạng 2</th>
                        <th>Chọn</th>
                    </tr>
                </thead>
                <tbody>
                    {% for chuyen_bay in chuyen_bays %}
                    <tr>
                        <td>{{ chuyen_bay.id }}</td>
                        <td>{{ chuyen_bay.ngay_gio_bay }}</td>
                        <td>{{ chuyen_bay.gia_ve_hang_1 }} VND</td>
                        <td>{{ chuyen_bay.gia_ve_hang_2 }} VND</td>
                        <td>
                            <input type="radio" name="chuyen_bay_id" value="{{ chuyen_bay.id }}" {% if chuyen_bay_chon and chuyen_bay_chon.id == chuyen_bay.id %}checked{% endif %}>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
             </table>
        </div>
        {% endif %}

        <!-- Phần thông tin vé chuyến bay -->
        {% if chuyen_bay_chon %}
        <h4 class="mt-4">Thông tin vé chuyến bay</h4>
        <div class="form-group">
            <label for="sdt">Số Điện Thoại Khách Hàng:</label>
            <input type="text" class="form-control" id="sdt" name="sdt" required>
        </div>
        <div class="form-group">
            <label for="ten_khach_hang">Tên Khách Hàng:</label>
            <input type="text" class="form-control" id="ten_khach_hang" name="ten_khach_hang" required>
        </div>
        <div class="form-group">
            <label for="cmnd_cccd">CMND/CCCD:</label>
            <input type="text" class="form-control" id="cmnd_cccd" name="cmnd_cccd" required>
        </div>
        <div class="form-group">
            <label for="hang_ghe">Hạng Ghế:</label>
            <select class="form-control" id="hang_ghe" name="hang_ghe" required>
                <option value="hang_1">Hạng 1</option>
                <option value="hang_2">Hạng 2</option>
            </select>
        </div>
        <div class="form-group">
            <label for="gia_ve">Giá Vé:</label>
            <input type="number" class="form-control" id="gia_ve" name="gia_ve" required>
        </div>
        <button type="submit" class="btn btn-primary" name="sell_ticket">Bán Vé</button>
        {% endif %}
    </form>
</div>
{% endblock %}
